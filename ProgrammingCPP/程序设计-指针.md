# 指针

## 0、导读

指针学习目标：指针在c语言中占有很重要的地位。从概念上就打好指针方面的基础。关于指针的学习概念是很重要的部分，所以要理解性的学习指针方面的知识。

## 1、内存地址

内存中任何存储区域空间或任何存储单元（字节），都有与之对应的内存地址。

c/cpp程序中定义变量`int a = 100;`。程序运行时在内存中开辟一片存储区域空间，把100整形数据这个资源存储到内存中。100是int类型占4个字节就是4个存储单元32个bit位，这片内存空间的起始存储单元的内存地址就是这个资源所占这片内存空间的地址。

变量在内存中的存储是需要多个连续的存储单元也就是字节组合而成的存储区域，这个区域有个起始地址。其实是在分配内存中过程中堆栈压栈后的最后一个存储单元就是起始存储单元，因为内存地址的列表是十六进制降序排列的，最后的存储单元的地址就成了这个存储区域的起始地址，这个存储区域的内存地址就是起始的存储单元地址。

通过内存地址获取完整的内存存储资源过程：计算机系统会自动在起始位置地址向下或者向后寻址需要的存储单元个数截止。比如int类型就会向下提取4个存储单元的内资源。

演示代码：

```c++
#include <iostream>
using namespace std;

int main()
{
    int a = 100;
    int b = 99;
    cout << &a << endl; //输出0x7ffce4e1629c
    cout << &b << endl; //输出0x7ffce4e16298
    return 0;
}
```

演示代码的十进制100的二进制是1100100。十进制99的二进制是1100011。

演示代码运行的内存存储状况：

>PS：列是bit总线地址，行是byte内存地址，因为是堆栈所以内存地址十六进制数是降序排列的。

| 内存的字节地址 | bit0 | bit1 | bit2 | bit3 | bit4 | bit5 | bit6 | bit7 |
| :-- | :-- | :-- | :-- | :-- | :-- | :-- | :-- | :-- |
| 0x7ffce4e1629c | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 |
| 0x7ffce4e1629b | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 |
| 0x7ffce4e1629a | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 |
| 0x7ffce4e16299 | 0 | 1 | 1 | 0 | 0 | 1 | 0 | 0 |
| 0x7ffce4e16298 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 |
| 0x7ffce4e16297 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 |
| 0x7ffce4e16296 | 0 | 0 | 0 | 0 | 0 | 0 | 0 | 0 |
| 0x7ffce4e16295 | 0 | 1 | 1 | 0 | 0 | 0 | 1 | 1 |

0x7ffce4e1629c就是变量a的内存地址，0x7ffce4e16298就是变量b的内存地址。都是存储空间区域的第一个字节的内存地址。

0x7ffce4e1629c转成十进制140724148462236
0x7ffce4e16298转成十进制140724148462232
相减正好是4，说明上下间隔4个字节，也就是int类型的所需的4个字节或4个存储单元。有的编译器会先存储b然后再去存储a，所以编译器的不同可能结果上的不同。

## 2、变量三要素

定义一个变量，并且对它进行初始化以后，内存中得到了一片存储空间，这片存储空间有一个起始的地址。这个变量还有一个变量的名字和数据类型。还有存储变量的值也就是资源。

变量的三要素：
- 1、变量的地址，变量在内存空间区域中起始存储单元的地址；
- 2、变量值，是内存存储的资源；资源这理解成（变量，常量，其他内存资源）；
- 3、内存地址对应资源的名称或者理解是变量名和数据类型，因为数据类型决定了在内存的存储空间大小；

## 3、指针

### 3.1、指针概念定义
指向一个内存资源的**内存地址**即为**指向该资源的指针**，而内存地址即为**指针**。

通常把某个变量的内存地址称为指向该变量的指针。一个变量的地址就是指向这个变量的指针。

### 3.2、指针的意义
通过指针访问指针指向的标定资源。

> PS:这里表述的是**指针**，而不是**指针变量**，这两个是不同概念。

### 指针的使用

#### 获取指针
获取方式：通过指针运算符&来获取指针

获取指针表达式：

```c++
&加上资源名称; //即可获取该名称资源的指针。也就是资源内存存储区域的起始单元的内存地址。
```

example1

```c++
int a = 1;
&a; //获取变量a内存存储地址，即为获取指向变量a的指针。
int b;
cout << &a; //打印出变量a的指针。
```

example2

```c++
#include <iostream>
#include <typeinfo> //引入typeinfo类库
using namespace std;

int main()
{
    int a = 100;
    cout << &a << endl; //输出变量a的指针
    cout << typeid(a).name() << endl; //输出i表示是int类型
    cout << typeid(&a).name() << endl; //输出Pi表示类型是指针，指向整数int资源的指针

    char b;
    b = 'a';
    cout << &b << endl; //输出变量b的指针
    cout << typeid(b).name() << endl; //输出c表示是char类型
    cout << typeid(&b).name() << endl; // 输出Pc表示类型是指针，指向字符char资源的指针

    cout << sizeof(&a) << endl; //输出该指针在内存中的存储多个个字节空间
    cout << sizeof(&b) << endl; //输出该指针在内存中的存储多个个字节空间

    return 0;
}
```


指针的大小可以用sizeof函数获取，同样的代码在不同的编译器中指针的大小是不同的。比如docker的centos是8个字节。

#### 通过指针获取资源
指针运算符&加上资源名只是获取资源的指针，比如`&a;`只是获取a的指针。而获取指针对应的资源就需用另一个：指针运算符*

表达式格式：

```c++
*加上指针;
```

example：

```c++
#include <iostream>
using namespace std;

int main()
{
    int a = 100;
    cout << a << endl; //打印a的值，输出100
    cout << &a << endl; //打印a的指针，输出0x7fff8c685fa8，不同的环境可能不同
    int b;
    b = *&a; //将a指针指向的资源赋给b
    cout << b << endl; //打印b的值，输出100
    cout << *&a << endl; //打印a指针指向的资源，输出100
    return 0;
}
```


### 小结

`*&c`和`c`在c/cpp代码中是等价的。就是使用指针运算符\*加上指针访问资源和直接在代码中使用资源名访问资源这两种方式是等价的。

用指针运算符\*就可以去访问这个指针指向的资源。对于这个变量c的指针，我们又可以用\*加上这个地址，去访问这个资源。如果想用这个地址访问a的值并且打印 `cout<<*&a`。

编译时，编译器建立 变量名 到 地址 的映射。

## 指针变量

指针变量：专门用于存储指针（某个资源的内存地址）的变量叫做**指针变量**。

指针变量与普通变量只有存储的资源不同而已，因为指针变量存储的内存资源是指针地址，其他没有什么不同。指针变量也要有三要素：名称，资源，指针地址，也就是指针变量自己也有一个属于自己存储空间的指针与普通变量没有什么区别。

因为指针变量存储的资源是指针，表述的时候可以表述为：**指向‘资源名’的指针变量**。本来是2个变量因为指针变量存储了另一个资源的指针所以两个资源名称就有了关系。

**指针变量属于一种数据类型，就是属于指针数据类型。**

重点要理解指针与指针变量的区别：
1、什么是指针，内存地址
2、什么是指针变量，存储指针类型的变量数据类型
3、什么是指向资源名的指针变量，是表述方式

### 声明定义指针变量
指针类型的变量声明定义规范：定义一个指针类型的变量来存储‘指针’资源。

```c++
基类型 *变量名;
baseTypeName *pointerVariableName;//定义指针变量
```

基类型，用来指定指针变量的基类型。基类型是指针变量所指向变量的数据类型。可以理解为指针变量存储的指针所指向的资源数据类型，都是c/cpp中基础的常用的类型。

\*变量的类型，这里的\*是指针运算符，在这里标示了变量为指针变量类型变量。

```c++
#include <iostream>
using namespace std;

int main()
{
    int *pointer;//定义了一个指针变量。
    return 0;
}
```

指针变量的定义规范解析：

	int是基类型，可以把int称作指针变量pointer的基类型。
	*是标识了变量为指针类型
	pointer是指针变量名称


### 指针变量的使用
指针变量赋值规范：将获取到的变量的指针赋值给指针变量即可。

```c++
baseTypeName *pointerVariableName;//定义指针变量
pointerVariableName = &variableName;//指针变量的赋值
```

赋值完成后，称为指针变量pointerVariableName指向了变量variableName。

因为pointerVariableName是指针类型变量，所以直接使用`pointerVariableName = variableName;`变量赋值不是变量的指针赋值是非法代码，指针变量只能接受指针类型数据同时符合基类型的指针才能赋值。

example：

```c++
#include <iostream>
using namespace std;

int main()
{
    int *pointer; //定义了一个指针变量。
    int a = 100;
    pointer = &a; //&a获取a的指针，然后赋给指针变量pointer。赋值后，称指针变量pointer指向了变量a。
	cout << pointer << endl; //输出的是指针地址
    return 0;
}
```

指针变量访问存储的指针对应的资源：
因为指针变量存储的就只是指针而已，打印出来就可以看到就只是指针而已。可以用指针运算符\*实现获取指针对应的资源。

```c++
baseTypeName *pointerVariableName;//定义指针变量
pointerVariableName = &variableName;//指针变量的赋值
cout << *pointerVariableName << endl;//通过*加上指针变量名。可以访问指针变量pointerVariableName存储的指针所指向的variableName变量的资源。
```
\*pointerVariableName就是pointerVariableName所指向的存储单元的内容。

所以`*&variableName`和`variableName`在c/cpp代码中是等价的。



--------------
## 拓展

## 引用

## 参考

## Q&A
- 指针变量存储的都是指针，为什么要指定指针变量的基类型呢？
- 指针变量指向的是变量呢还是内存资源?

## 总结


## 故事

--------------
story：

连接：https://apod.nasa.gov/apod/image/0403/n49_hst_full.jpg
名称：N49星云
图片：![](./images/n49_hst_full.jpeg)


通过连接就可以获取到名字叫N49星云的图片资源。连接就是这是图片的地址。图片就是连接对应的对应的资源，名称就是该资源的名称。

可以把连接称为指向这个资源的指针（这里资源这里是指图片）。

这个连接就把它称作指针。

--------------